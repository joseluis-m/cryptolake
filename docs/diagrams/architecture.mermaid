graph TB
    subgraph Sources["ğŸ“¡ Data Sources"]
        BN[Binance WebSocket<br/>Real-time prices]
        CG[CoinGecko API<br/>Historical data]
        FG[Alternative.me<br/>Fear & Greed Index]
    end

    subgraph Ingestion["ğŸ”„ Ingestion Layer"]
        KF[Apache Kafka<br/>Topic: prices.realtime]
        EX[Python Extractors<br/>Batch: 7-day lookback]
    end

    subgraph Lakehouse["ğŸ”ï¸ Lakehouse â€” MinIO + Apache Iceberg"]
        direction LR
        BR["ğŸ¥‰ BRONZE<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>historical_prices<br/>fear_greed<br/><i>Append-only, raw</i>"]
        SL["ğŸ¥ˆ SILVER<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>daily_prices<br/>fear_greed<br/><i>Deduped, typed</i>"]
        GL["ğŸ¥‡ GOLD<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>fact_market_daily<br/>dim_coins<br/>dim_dates<br/><i>Star schema</i>"]
        BR -->|"Spark Batch<br/>MERGE INTO"| SL
        SL -->|"dbt run<br/>Window functions"| GL
    end

    subgraph Orchestration["â° Orchestration"]
        AF[Apache Airflow<br/>DAG: 06:00 UTC daily]
    end

    subgraph Quality["âœ… Quality"]
        DQ[Custom Validators<br/>Bronze: 8 checks<br/>Silver: 8 checks<br/>Gold: 5 checks]
    end

    subgraph Serving["ğŸ–¥ï¸ Serving Layer"]
        API[FastAPI :8000<br/>/docs /prices /analytics]
        DB[Streamlit :8501<br/>Charts & KPIs]
    end

    subgraph CICD["ğŸ”§ DevOps"]
        GH[GitHub Actions<br/>lint â†’ test â†’ build]
        TF[Terraform<br/>AWS S3 modules]
    end

    BN --> KF
    CG --> EX
    FG --> EX
    KF --> BR
    EX --> BR
    AF -.->|orchestrates| Ingestion
    AF -.->|orchestrates| Lakehouse
    AF -.->|orchestrates| Quality
    GL -->|PyHive / Thrift| API
    API -->|HTTP| DB
