graph TB
    subgraph Sources["Data Sources"]
        BN["Binance WebSocket - Real-time prices"]
        CG["CoinGecko API - Historical data"]
        FG["Alternative.me - Fear and Greed Index"]
    end

    subgraph Ingestion["Ingestion Layer"]
        KF["Apache Kafka - Topic: prices.realtime"]
        EX["Python Extractors - Batch: 7-day lookback"]
    end

    subgraph Lakehouse["Lakehouse -- MinIO + Apache Iceberg"]
        BR["BRONZE | historical_prices, fear_greed | Append-only, raw"]
        SL["SILVER | daily_prices, fear_greed | Deduped, typed"]
        GL["GOLD | fact_market_daily, dim_coins, dim_dates | Star schema"]
        BR -->|"Spark MERGE INTO"| SL
        SL -->|"dbt + Window functions"| GL
    end

    subgraph Orchestration["Orchestration"]
        AF["Apache Airflow - DAG: 06:00 UTC daily"]
    end

    subgraph Quality["Data Quality"]
        DQ["Custom Validators - 21 checks across Bronze, Silver, Gold"]
    end

    subgraph Serving["Serving Layer"]
        API["FastAPI :8000 - REST API + OpenAPI docs"]
        DB["Streamlit :8501 - Interactive dashboard"]
    end

    subgraph DevOps["CI/CD and Infrastructure"]
        GH["GitHub Actions - lint, test, dbt compile, docker build"]
        TF["Terraform - AWS S3 modules + lifecycle policies"]
    end

    BN --> KF
    CG --> EX
    FG --> EX
    KF --> BR
    EX --> BR
    AF --> Ingestion
    AF --> Lakehouse
    AF --> Quality
    GL -->|"PyHive via Thrift"| API
    API -->|"HTTP JSON"| DB
